<!DOCTYPE html>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<body>
    <input type="text" placeholder="user id" id="idInput">
    <button type="submit" id="idSubmit">get new code</button>
    <p id="idEcho">ID Echo: </p>
    <br><br>
    <input type="text" placeholder="code" id="codeInput">
    <button type="submit" id="codeSubmit">get auth tokens</button>
    <p id="codeEcho">Code Echo: </p>
</body>

<script>
    function acceptID(id) {
        var toSend = JSON.stringify({id: id})
        console.log(toSend)
        $.ajax({
            url: 'http://localhost:3000/newUserCode',
            type: 'POST',
            data: toSend,
            dataType: 'json',
            contentType: 'application/json',
            success: (data, textStatus, jqXHR) => {
                console.log(data)
                console.log(data.code)
                console.log("New code generated");
                document.querySelector('#idEcho').append(data.code);
                // if (typeof data.redirect == 'string') {
                //     window.location = data.redirect;
                // }
            }
        })
    }

    function acceptCode(code) {
        document.querySelector('#codeEcho').append(code);
        var toSend = JSON.stringify({code: code})
        console.log(toSend)
        let xhttp = new XMLHttpRequest();
        xhttp.open("POST", "http://localhost:3000/getAuthTokens", true);
        xhttp.setRequestHeader('Content-Type', 'application/json');
        xhttp.send(toSend);
    }

    

    document.getElementById('idSubmit').onclick = function() {
        console.log("id submit");
        var toSend = JSON.stringify({id: document.querySelector('#idInput').value})
        console.log(toSend)
        $.ajax({
            url: 'http://localhost:3000/newUserCode',
            type: 'POST',
            data: toSend,
            dataType: 'json',
            contentType: 'application/json',
            success: (data, textStatus, jqXHR) => {
                console.log(data)
                console.log(data.code)
                console.log("New code generated");
                document.querySelector('#idEcho').innerHTML = data.code;
            }
        })
    }

    document.getElementById('codeSubmit').onclick = function() {
        console.log("code submit");
        // document.querySelector('#codeEcho').innerHTML = "?";
        var toSend = JSON.stringify({code: document.querySelector('#codeInput').value})
        console.log(toSend)
        $.ajax({
            url: 'http://localhost:3000/getAuthTokens',
            type: 'POST',
            data: toSend,
            dataType: 'json',
            contentType: 'application/json',
            success: (data, textStatus, jqXHR) => {
                if (typeof data.redirectURL == 'string') {
                    console.log(data.redirectURL)
                    window.location = data.redirectURL;
                }
            }
        })

        // let xhttp = new XMLHttpRequest();
        // xhttp.open("POST", "http://localhost:3000/getAuthTokens", true);
        // xhttp.setRequestHeader('Content-Type', 'application/json');
        // xhttp.send(toSend);
    }

</script>